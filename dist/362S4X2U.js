import{D as c}from"./DSVEVIWB.js";async function a(e,i,s){let u=s==="input"?{clientRequestId:crypto.randomUUID(),llmInput:e}:{clientRequestId:crypto.randomUUID(),llmOutput:e},r=`https://aisec.akamai.com/fai/v1/fai-configurations/${c.AI_FIREWALL_CONFIG_ID}/detect`,t=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json","Fai-Api-Key":c.AI_FIREWALL_KEY},body:JSON.stringify(u)}),o=await t.text();if(i.log.debug({detectMode:s,url:r,status:t.status,statusText:t.statusText,responseBody:o}),!t.ok)throw new Error(`FAI detect failed (${s}). HTTP ${t.status} ${t.statusText} \u2014 ${o?.slice(0,500)}`);return JSON.parse(o)}function g(e){return typeof e=="string"?e:e instanceof Uint8Array?new TextDecoder().decode(e):String(e)}async function f(e,i,s,u,r){try{let t=g(e),n=(await a(t,r,"input")).rulesTriggered.filter(l=>l.action==="deny");if(n.length===0)return e;s.send(`Firewall for AI denied inbound message: ${n[0].message} (Rule: ${n[0].ruleId})`);return}catch(t){r.log.error({err:t,phase:"inbound"})}return e}async function I(e,i,s,u,r){try{let t=g(e),n=(await a(t,r,"output")).rulesTriggered.filter(l=>l.action==="deny");if(n.length===0)return e;i.send(`Firewall for AI denied outbound message: ${n[0].message} (Rule: ${n[0].ruleId})`);return}catch(t){r.log.error({err:t,phase:"outbound"})}return e}export{f as inboundFirewallPolicy,I as outboundFirewallPolicy};
//# sourceMappingURL=362S4X2U.js.map
